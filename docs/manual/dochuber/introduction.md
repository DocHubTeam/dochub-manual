# Dochuber

Dochuber — это AI-ассистент, который помогает в развитии документации и архитектуры предприятия.
Он имеет встроенные навыки зависящие от выбранной модели и может специализироваться под конкретный
репозиторий.

## Встроенные навыки

1. Общие знания из различных предметных областей для решения задач развития репозитория;
2. Генерация и редактирование контента документов и диаграмм;
3. Помощь при редактировании архитектурного описания на основании знаний о метамодели;
4. Аналитические ответы по репозиторию: поиск->анализ->формулирование ответа.

## Выбор модели

Базовым способом улучшить качество ответов Dochuber является выбор используемой модели. 
Это можно сделать в настройках Dochuber, доступных в разделе [настройки](/settings#ai-dochuber).
В настоящее время оптимальным по соотношению качество/цена считается модель "gpt4.1-mini".

## Возможности конфигурирования

Для обеспечения высокого качества ответов AI-агента необходимо подготовить качественный контекст.
Контекст — это информация, которая обеспечивает релевантные и точные ответы на запросы пользователя.
В случае Dochuber контекст может включать данные о репозитории, метамодели, документации и архитектуре
предприятия.

Dochuber оснащён встроенным механизмом генерации контекста. Во многих случаях он вполне достаточен.
Однако по мере того как репозиторий приобретает уникальные свойства, этот механизм может потребовать 
модификации. Для решения этой задачи в Dochuber предусмотрена возможность влиять на процесс генерации
контекстов через его конфигурацию.

На текущий момент есть два механизма наполнения контекста необходимой информацией:
1. **Генераторы контекстов** - Позволяет непосредственно влиять на информационное наполнение контекста;
2. **Модули знаний** - Подключаются по запросу AI-агента, когда он считает их необходимыми.

## Генераторы глобального контекста

Глобальные контексты отлично подходят для корпоративных стандартов. Например, если вы хотите явно зафиксировать 
технологический стек используемый в компании, то это можно сделать так:

```code-frame
/dochuber/contexts/global/dochub.rules.techstack
```

Теперь, если задать вопрос Dochuber о количестве документов в репозитории он будет давать примерно такие ответы:

```
Вопрос: Могу я использовать WebOS и VUE2?
Ответ:   Согласно стандарту №1 технологического стека, который актуален для всего репозитория,
         разрешено использовать технологию VUE2, а технология WebOS в списке разрешенных отсутствует.

         Таким образом:
         * VUE2 можно использовать.
         * WebOS использовать нельзя, так как она не входит в утвержденный технологический стек.
  
         Если хотите, могу помочь подобрать альтернативы или объяснить подробнее.
```

**ВНИМАНИЕ**:
1. Необходимо осмотрительно использовать генераторы глобального контекста. Производимая ими информация включается
   в каждый запрос к агенту, что напрямую влияет на объем запроса и может значительно повышать их стоимость.
2. Тщательно контролируйте качество генерации информации глобальных контекстов. Противоречивая, недостаточная
   или неточная информация может запутать агента и повлияет на все ответы агента.

## Условные генераторы контекстов

В отличии от генераторов глобальных контекстов, условные генераторы подключаются к запросу по определенному в
них условию. Например, если запрос пользователя содержит ключевое слово.

__Данный функционал в разработке. Ожидайте новых релизов.__

# Модули знаний

Модули знаний работают по тому же принципу генерации информации, что и генераторы контекстов. Однако причины их
включения в контекст запроса к AI отличаются — Dochuber самостоятельно определяет, когда использовать модуль.
Это обеспечивает их гибкое подключение, значительно расширяя возможности агента в решении разнообразных задач
не перегружая информацией запросы к AI.

Пример демонстрирует интеграцию Dochuber с внешним ресурсом предоставляющим информацию о погоде в России:

```code-frame
/dochuber/knowledge/dochub.integrations.weather
```

Теперь, при обращении к Dochuber с вопросом о погоде, он воспользуется модулем знания:
```
Вопрос:  Какая погода в России?
Ответ:   В России сейчас наблюдается следующая погодная ситуация:
         * В Санкт-Петербурге ожидается небольшое потепление, но температура днем составляет
           около +9..+12 градусов, ночью возможны заморозки.
         * В Москве и области 12 мая ожидается холодная погода с температурой днем 8..10 градусов,
           возможны небольшие дожди и умеренный ветер.

         Если хотите, могу предоставить более детальный прогноз по конкретному региону. 
```


## Типы генераторов

* **resource**    — определяет ресурс, доступный по URI, как контекст. Это может быть файл в текущем или стороннем
                    репозитории, а также ссылка на любой другой ресурс, например, по HTTP.
* **dataset**     — этот тип используется по умолчанию. Генератор воспринимается как [dataset](@document/dochub.datasets)
                    и должен вернуть текстовую информацию, которая будет использоваться как контекст.
* **generator**   — если указан этот тип, то сам генератор воспринимается как [dataset](@document/dochub.datasets),
                    но, в отличие от типа "dataset", результатом его выполнения должен стать не текст, а массив генераторов.
                    Такой подход позволяет создавать сложные, автоматически генерируемые деревья формирования контекстов.

Ниже будут рассмотрены все типы подробно.

### Тип генератора "resource"

Самый простой тип генератора. Он загружает ресурс, указанный в поле "source". Не стоит недооценивать его значение, так
как ссылка может быть как относительным путем к файлу в текущем репозитории, так и HTTP-ссылкой, ведущей
на API корпоративного сервиса, что дает широкие возможности по интеграции DocHub с внешним ландшафтом.

Принимает решение о подключении знания Dochuber на основании запроса пользователя и описания самого модуля знания.
Описание сдержится в обязательном поле "description".

Пример демонстрирует интеграцию Dochuber с внешним ресурсом предоставляющим информацию о погоде в России:

```code-frame
/dochuber/contexts/global/dochub.integrations.weather
```

В результате AI-агент может отвечать на вопросы о погоде:

```
Вопрос: Какая погода сейчас в Сибири?
Ответ: На основании предоставленных данных можно сказать, что в Сибири наблюдается переменчивая погода. В Западной Сибири
погодная ситуация нестабильна: циклоны чередуются с антициклонами, тёплые воздушные массы сменяются холодными.
В Ямало-Ненецком автономном округе ожидаются осадки в виде снега и мокрого снега, метель и сильный ветер.
```

### Тип генератора "dataset"

Этот тип генератора предназначен для подготовки контекста на основе архитектурного datalake. Его функционирование аналогично
работе [dataset](@document/dochub.datasets). В результате своей работы он должен выдавать текст. Любые другие форматы данных
будут автоматически преобразованы в текстовый формат.

Выше был рассмотрен базовый пример использования генератора типа "dataset", который вычислял количество документов в 
репозитории. Теперь рассмотрим более сложный пример: генератор будет формировать детализированную информацию о
технологическом стеке и формулировать требования к его использованию при описании архитектурных компонентов.

```code-frame
/dochuber/contexts/global/dochub.rules.techstack
```
В этом случае ответы AI-агента будут иметь вид:
```
Вопрос: Какой техстек используется?
Ответ: SberPay; Go; PHP; HTTP; Chrome; Firefox; Safari; GitLab; Git; PlantUML; graphviz; JavaScript; VUEJS2; VUE2; VUEX; Axios; Markdown; JSONata.

Вопрос: Могу ли я использовать технологии JSONata и WebOS?
Ответ: Да, вы можете использовать технологию JSONata, так как она входит в указанный технологический стек.
Однако WebOS в списке доступных технологий не упоминается, поэтому её использование не рекомендуется.
```

### Тип генератора "generator"

Тип генератора "generator" в Dochuber предназначен для создания сложных, автоматически генерируемых деревьев контекстов.
В отличие от типа "dataset", результатом выполнения генератора типа "generator" должен стать не текст, а массив генераторов.
Это позволяет создавать иерархические структуры контекстов, которые могут быть полезны для сложных репозиториев.

Рассмотрим пример в котором генерируется контекст из документов о [метамодели DocHub](@document/dochub.flex_metamodel.introduction),
что позволит создавать пользовательские сущности.

```code-frame
/dochuber/contexts/global/dochub.metamodel
```

В результате AI-агент сможет отвечать на вопросы пользователя по метамодели и помогать ее развивать.

```
Вопрос: Расскажи мне о метамодели в DocHub.
Ответ: Метамодель в DocHub — это основа для создания пользовательских сущностей и организации данных в репозитории. Она
определяет структуру и взаимосвязи между различными элементами документации и архитектуры предприятия. Благодаря метамодели
обеспечивается согласованность и целостность информации, что важно для эффективного управления репозиторием.

Вопрос: Опиши простую сущность DocHub для пользователя. Сущность должна включать те поля, которые ты считаешь нужными, а также дату рождения.
Ответ: 
  entities:
    user:
      title: Пользователь
      description: Основные данные о пользователе
      schema:
        type: object
        properties:
          username:
            title: Имя пользователя
            type: string
            minLength: 1
          email:
            title: Электронная почта
            type: string
            format: email
          dateOfBirth:
            title: Дата рождения
            type: string
            format: date
        required:
          - username
          - email
          - dateOfBirth
```

