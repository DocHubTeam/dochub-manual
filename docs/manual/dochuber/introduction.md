# Dochuber

Dochuber — это AI-ассистент, который помогает в развитии документации и архитектуры предприятия.
Он имеет встроенные навыки зависящие от выбранной модели и может специализироваться под конкретный
репозиторий.

## Базовые навыки

1. Общие знания из различных предметных областей для решения задач развития репозитория;
2. Генерация и редактирование контента документов и диаграмм;
3. Помощь при редактировании архитектурного описания на основании знаний о метамодели;
4. Аналитические ответы по репозиторию: поиск->анализ->формулирование ответа.

## Выбор модели

Базовым способом улучшить качество ответов Dochuber является выбор используемой модели. 
Выбрать модель можно в настройках Dochuber, доступных в разделе [настройки](/settings#ai-dochuber).
В настоящее время оптимальным по соотношению цена/качество считается модель **"gpt4.1-mini"**.

## Возможности конфигурирования

Для обеспечения высокого качества ответов AI-агента необходимо подготовить качественный контекст.
Контекст — это информация, которая обеспечивает релевантные и точные ответы на запросы пользователя.
В случае Dochuber контекст может включать данные о репозитории, метамодели, документации и архитектуре
предприятия.

Dochuber оснащён встроенным механизмом генерации контекста. Во многих случаях он вполне достаточен.
Однако по мере того как репозиторий приобретает уникальные свойства, этот механизм может потребовать 
модификации. Для решения этой задачи в Dochuber предусмотрена возможность влиять на процесс генерации
контекстов через его конфигурацию.

На текущий момент есть два механизма наполнения контекста необходимой информацией:
1. **Генераторы контекстов** - Позволяет непосредственно влиять на информационное наполнение контекста;
2. **Модули знаний** - Подключаются по запросу AI-агента, когда он считает их необходимыми.

## Генераторы контекстов

Контекст для AI-модели — это совокупность информации, которая предоставляется модели для понимания и решения
конкретной задачи или запроса пользователя. Контекст определяет релевантность и точность ответов, так как AI-модель
опирается на него при генерации ответов.

### Генераторы глобального контекста

Глобальные контексты отлично подходят для корпоративных стандартов. Например, если вы хотите явно зафиксировать 
технологический стек используемый в компании, то это можно сделать так:

```code-frame
/dochuber/contexts/global/dochub.rules.techstack
```

Теперь, если задать вопрос Dochuber о количестве документов в репозитории он будет давать примерно такие ответы:

```
Вопрос:  Могу я использовать WebOS и VUE2?
Ответ:   Согласно стандарту №1 технологического стека, который актуален для всего репозитория,
         разрешено использовать технологию VUE2, а технология WebOS в списке разрешенных отсутствует.

         Таким образом:
         * VUE2 можно использовать.
         * WebOS использовать нельзя, так как она не входит в утвержденный технологический стек.
  
         Если хотите, могу помочь подобрать альтернативы или объяснить подробнее.
```

**ВНИМАНИЕ**:
1. Необходимо осмотрительно использовать генераторы глобального контекста. Производимая ими информация включается
   в каждый запрос к агенту, что напрямую влияет на объем запроса и может значительно повышать их стоимость.
2. Тщательно контролируйте качество генерации информации глобальных контекстов. Противоречивая, недостаточная
   или неточная информация может запутать агента и повлияет на все ответы агента.

### Условные генераторы контекстов

В отличии от генераторов глобальных контекстов, условные генераторы подключаются к запросу по определенному в
них условию. Например, если запрос пользователя содержит ключевое слово.

__Данный функционал в разработке. Ожидайте новых релизов.__

### Модули знаний

Модули знаний работают по тому же принципу генерации информации, что и генераторы контекстов. Однако причины их
включения в контекст запроса к AI отличаются — Dochuber самостоятельно определяет, когда использовать модуль.
Это обеспечивает их гибкое подключение, значительно расширяя возможности агента в решении разнообразных задач
не перегружая информацией запросы к AI.

Пример демонстрирует интеграцию Dochuber с внешним ресурсом предоставляющим информацию о погоде в России:

```code-frame
/dochuber/knowledge/dochub.integrations.weather
```

Теперь, при обращении к Dochuber с вопросом о погоде, он воспользуется модулем знания:
```
Вопрос:  Какая погода в России?
Ответ:   В России сейчас наблюдается следующая погодная ситуация:
         * В Санкт-Петербурге ожидается небольшое потепление, но температура днем составляет
           около +9..+12 градусов, ночью возможны заморозки.
         * В Москве и области 12 мая ожидается холодная погода с температурой днем 8..10 градусов,
           возможны небольшие дожди и умеренный ветер.

         Если хотите, могу предоставить более детальный прогноз по конкретному региону. 
```

## Генераторы Dochuber

Генераторы в контексте Dochuber — это механизмы, которые формируют контекст для AI-модели, предоставляя ей релевантную информацию
для решения конкретных задач или ответов на запросы пользователя.

Существует три основных типа генераторов:

* **resource**    — определяет ресурс, доступный по URI, как контекст. Это может быть файл в текущем или стороннем
                    репозитории, а также ссылка на любой другой ресурс, например, по HTTP.
* **dataset**     — этот тип используется по умолчанию. Генератор воспринимается как [dataset](@document/dochub.datasets)
                    и должен вернуть текстовую информацию, которая будет использоваться как контекст.
* **generator**   — если указан этот тип, то сам генератор воспринимается как [dataset](@document/dochub.datasets),
                    но, в отличие от типа "dataset", результатом его выполнения должен стать не текст, а массив генераторов.
                    Такой подход позволяет создавать сложные, автоматически генерируемые деревья формирования контекстов.

Ниже будут рассмотрены все типы подробно.

### Тип генератора "resource"

Самый простой тип генератора. Он загружает ресурс, указанный в поле "source". Не стоит недооценивать его пользу.
Ссылка на ресурс может быть как относительным путем к файлу в текущем репозитории, так и HTTP-ссылкой, ведущей
на API корпоративного сервиса, что дает широкие возможности по интеграции DocHub с внешним ландшафтом.

Пример демонстрирует интеграцию Dochuber с внешним ресурсом предоставляющим информацию о точном времени. 
Информацию оформляем как знание:

```code-frame
/dochuber/knowledge/dochub.integrations.time
```

В результате AI-агент может отвечать на вопросы о текущем времени:

```
Вопрос: Сколько сейчас времени в Москве?
Ответ: Сейчас в Москве 13 мая 2025 года, 11:56 по местному времени.
       Если нужно, могу помочь с другой информацией.
```

Обратите внимание, что в "description" знания указано, что оно должно каждый раз обновляться при запросе пользователя.
Таким образом вы можете стимулировать агента для его актуализации.

**ВАЖНО**: Обращайте внимание на возможное кэширование данных браузером или инфраструктурой. Если данные кэшируются,
обновление не приведет к ожидаемому результату.

### Тип генератора "dataset"

Этот тип генератора предназначен для подготовки контекста на основе архитектурного DataLake. Его функционирование аналогично
работе [dataset](@document/dochub.datasets). В результате своей работы он должен возвращать текст. Любые другие форматы данных
будут автоматически преобразованы в текстовый формат.

Выше был рассмотрен базовый пример использования генератора типа "dataset", который формировал правило использования 
технологического стека. Теперь рассмотрим пример статистического анализа:

```code-frame
/dochuber/knowledge/dochub.statistics
```
В этом случае ответы AI-агента будут иметь вид:
```
Вопрос: Сколько документов в репозитории?
Ответ:  В репозитории сейчас содержится 100 документов.
        Если нужна дополнительная информация по репозиторию, пожалуйста, сообщите.
```

### Тип генератора "generator"

Тип "generator" это фабрика простых генераторов "dataset" и "resource". Он позволяет динамически расширять контекст.
Результатом работы такого генератора должен быть массив алгоритмически созданных генераторов. В том числе, массив может
включать тип генератора "generator".

Все обнаруженные DocHub генераторы данного типа исполняются и приводятся к массиву простых.

Рассмотрим пример в котором все документы конвертируются в знания:

```code-frame
/dochuber/knowledge/dochub.docs
```

В примере используется функция `$dochuberFetchDocs`. Т.к. подобное конвертирование может потребоваться многократно, рационально
создать функцию для облегчения решения этой задачи:

```code-frame
/functions/dochuberFetchDocs
```
В результате AI-агент сможет отвечать на вопросы пользователя по документации DocHub:

```
Вопрос: Как работают источники данных в DocHub?
Ответ:  Источники данных (datasets) в DocHub работают как таблицы с данными, но сами по себе не
        визуализируют информацию, а предоставляют её потребителям.

        Основные особенности работы источников данных:
        * Источники могут содержать предопределённые данные, описанные в формате
          YAML или JSON. Например, можно определить уровни критичности с их идентификаторами
          и названиями.
        * К источникам данных можно делать запросы с помощью JSONata — языка запросов к
          архитектурным данным. Это позволяет выбирать, фильтровать и сортировать данные из
          архитектуры.
        * Источники данных могут зависеть друг от друга. Один источник может использовать данные
          другого в качестве основы и дополнительно их обрабатывать.
        * Возможна множественная зависимость, когда источник консолидирует данные из нескольких
          других источников для последующей обработки и обогащения.

        Таким образом, источники данных в DocHub обеспечивают гибкий и мощный механизм доступа
        и обработки архитектурных данных, позволяя строить сложные запросы и получать
        структурированную информацию для дальнейшего использования и визуализации.
```

**ВАЖНО:**
Необходимо помнить, что качество ответов AI-ассистента напрямую зависит от выбранной AI-модели и 
качества информации, которая передана ему для решения задачи.

Удачи в использовании Dochuber!

